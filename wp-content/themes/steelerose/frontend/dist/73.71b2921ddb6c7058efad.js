(window.webpackJsonp=window.webpackJsonp||[]).push([[73],{356:function(e,t,n){"use strict";function r(e,t,n,r,a,i,o){try{var s=e[i](o),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,a)}function a(e){return function(){var t=this,n=arguments;return new Promise((function(a,i){var o=e.apply(t,n);function s(e){r(o,a,i,s,c,"next",e)}function c(e){r(o,a,i,s,c,"throw",e)}s(void 0)}))}}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n.r(t),n.d(t,"default",(function(){return u}));var s=new Headers({"content-type":"application/json","X-WP-Nonce":Globals.rest_nonce}),c={template:Globals.api_url+"twig/get-template/",intent:Globals.api_url+"stripe/payment/setup-intent/"},u=function(){function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),o(this,"form",{}),o(this,"intent",!1),o(this,"getForm",function(){var e=a(regeneratorRuntime.mark((function e(n,r){var a,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.setupIntent(r);case 2:return a={method:"post",mode:"cors",body:JSON.stringify({path:"take-payment",filename:"take-payment.twig",data:{amount:r/100,product:n}}),headers:s},e.next=5,fetch(c.template,a);case 5:return i=e.sent,e.next=8,i.json();case 8:return e.abrupt("return",e.sent);case 9:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),o(this,"bindForm",function(){var e=a(regeneratorRuntime.mark((function e(n,r){var i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(i=t.form).find("button[type=submit]").on("click",a(regeneratorRuntime.mark((function e(){var r,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.loading(!0),r=i.find("input#card-name").val(),a={error:{}},r=r||!1){e.next=7;break}a.error.message="Add the name on card.",e.next=10;break;case 7:return e.next=9,stripe.confirmCardPayment(t.intent.client_secret,{payment_method:{card:n.cardNumber,billing_details:{name:r,email:Globals.user_logged_in_email}}});case 9:a=e.sent;case 10:t.loading(!1),a.error?i.find(".take-payment__errors").addClass("validation_error").html(a.error.message):document.dispatchEvent(new CustomEvent("payment-accepted"));case 12:case"end":return e.stop()}}),e)}))));case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),o(this,"applyStripe",function(){var e=a(regeneratorRuntime.mark((function e(n){var r,a,i,o,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=$(n.contentEl),t.form=n,e.t0=JSON,e.next=5,$.ajax({type:"get",url:Globals.ajax_url,data:{action:"stripe_preload_assets"}});case 5:if(e.t1=e.sent,r=e.t0.parse.call(e.t0,e.t1),"undefined"!=typeof Stripe){e.next=11;break}return e.next=10,$.getScript(r.url);case 10:window.stripe=Stripe(r.key);case 11:a=stripe.elements({locale:"auto"}),o={focus:"focused",empty:"empty",invalid:"invalid"},s={base:{}},(i={}).cardNumber=a.create("cardNumber",{classes:o,style:s}),i.cardNumber.mount(n.find("#card-number")[0]),i.cardExpiry=a.create("cardExpiry",{classes:o,style:s}),i.cardExpiry.mount(n.find("#card-expiry")[0]),i.cardCvc=a.create("cardCvc",{classes:o,style:s}),i.cardCvc.mount(n.find("#card-cvc")[0]),t.card=i,t.elements=a,t.bindForm(t.card,t.elements),t.loading(!1);case 24:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),o(this,"setupIntent",function(){var e=a(regeneratorRuntime.mark((function e(n){var r,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={method:"post",mode:"cors",body:JSON.stringify({amount:n}),headers:s},e.next=3,fetch(c.intent,r);case 3:return a=e.sent,e.next=6,a.json();case 6:t.intent=e.sent,console.log(t.intent);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}var t,n,r;return t=e,(n=[{key:"loading",value:function(e){var t=this.form;e?(t.find(".dpl-take-payment").addClass("hide"),t.find(".spinner").removeClass("hide")):(t.find(".dpl-take-payment").removeClass("hide"),t.find(".spinner").addClass("hide"))}}])&&i(t.prototype,n),r&&i(t,r),e}()}}]);
//# sourceMappingURL=73.71b2921ddb6c7058efad.js.map