(window.webpackJsonp=window.webpackJsonp||[]).push([[80],{382:function(t,e,n){"use strict";n.r(e),n.d(e,"default",(function(){return k}));var r=n(415),a=n(383),o=n(368);function s(t){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function c(t,e,n,r,a,o,s){try{var c=t[o](s),u=c.value}catch(t){return void n(t)}c.done?e(u):Promise.resolve(u).then(r,a)}function u(t){return function(){var e=this,n=arguments;return new Promise((function(r,a){var o=t.apply(e,n);function s(t){c(o,r,a,s,u,"next",t)}function u(t){c(o,r,a,s,u,"throw",t)}s(void 0)}))}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function l(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function p(t,e){return(p=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function f(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=d(t);if(e){var a=d(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return m(this,n)}}function m(t,e){return!e||"object"!==s(e)&&"function"!=typeof e?b(t):e}function b(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function d(t){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function h(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var y=new Headers({"content-type":"application/json","X-WP-Nonce":Globals.rest_nonce}),v={updateBasket:Globals.api_url+"pmachine/task-basket/update",updateForm:Globals.api_url+"pmachine/form/update-key-value"},k=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&p(t,e)}(m,t);var e,n,s,c=f(m);function m(){var t;i(this,m);for(var e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return h(b(t=c.call.apply(c,[this].concat(n))),"state",{loading:!1,paymentActive:!1,view:!1}),h(b(t),"paymentComplete",u(regeneratorRuntime.mark((function e(){var n,r,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.props,r=n.close,a=n.tasks,e.next=3,a.forEach(function(){var t=u(regeneratorRuntime.mark((function t(e){var n,a,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n="purchased",a={method:"post",mode:"cors",body:JSON.stringify({task:e.task,status:n}),headers:y},t.next=4,fetch(v.updateBasket,a);case 4:return o=t.sent,t.next=7,o.json();case 7:return t.sent,a={method:"post",mode:"cors",body:JSON.stringify([{id:e.task,status:n}]),headers:y},t.next=11,fetch(v.updateForm,a);case 11:return o=t.sent,t.next=14,o.json();case 14:t.sent,document.dispatchEvent(new CustomEvent("tasks-updated")),r();case 17:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}());case 3:case"end":return e.stop()}}),e)})))),h(b(t),"pay",(function(){t.setState({paymentActive:!0},u(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.paymentHtml();case 2:case"end":return e.stop()}}),e)}))))})),h(b(t),"paymentHtml",u(regeneratorRuntime.mark((function e(){var n,o,s,c,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.props,o=n.tasks,s=n.close,t.setState({loading:!0}),c=Object(r.h)("h3",null,"Payment for tasks"),i=Object(r.h)("p",{className:"alignright"},Object(r.h)("br",null),Object(r.h)("button",{onClick:function(){return s()},className:"dpl-button small"},"Close")),t.setState({view:Object(r.h)("div",null,c,Object(r.h)(a.default,{tasks:o}),i),loading:!1},u(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}}),t)}))));case 5:case"end":return e.stop()}}),e)})))),h(b(t),"tasksHtml",(function(){var e=t.props,n=e.tasks,a=e.close,o=b(t).pay,s=Object(r.h)("h3",null,"Tasks in basket"),c=Object(r.h)("div",{className:"task-basket__row"},Object(r.h)("div",{className:"task-basket__task"},"Task"),Object(r.h)("div",{className:"task-basket__amount"},"Amount"),Object(r.h)("div",{className:"task-basket__status"},"Status")),u=n.map((function(t,e){return Object(r.h)("div",{className:"task-basket__row"},Object(r.h)("div",{className:"task-basket__task"},t.task),Object(r.h)("div",{className:"task-basket__amount"},(t.price/100).toFixed(2)),Object(r.h)("div",{className:" task-basket__status"},Object(r.h)("span",{className:t.status},t.status)))})),i=Object(r.h)("p",{className:"alignright"},Object(r.h)("br",null),Object(r.h)("button",{onClick:function(){return o()},className:"dpl-button small"},"Pay"),"Â ",Object(r.h)("button",{onClick:function(){return a()},className:"dpl-button small"},"Close"));t.setState({view:Object(r.h)("div",null,s,c,u,i),loading:!1})})),t}return e=m,(n=[{key:"componentDidMount",value:function(){var t=this;this.tasksHtml(),document.addEventListener("payment-accepted",u(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.paymentComplete();case 1:case"end":return e.stop()}}),e)}))))}},{key:"render",value:function(){var t=this.state,e=t.loading,n=t.view;return e?Object(r.h)(o.default,null):n}}])&&l(e.prototype,n),s&&l(e,s),m}(r.Component)}}]);
//# sourceMappingURL=80.71b2921ddb6c7058efad.js.map