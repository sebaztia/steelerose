(window.webpackJsonp=window.webpackJsonp||[]).push([[15,80],{382:function(t,e,n){"use strict";n.r(e),n.d(e,"default",(function(){return k}));var r=n(415),o=n(383),a=n(368);function c(t){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function u(t,e,n,r,o,a,c){try{var u=t[a](c),s=u.value}catch(t){return void n(t)}u.done?e(s):Promise.resolve(s).then(r,o)}function s(t){return function(){var e=this,n=arguments;return new Promise((function(r,o){var a=t.apply(e,n);function c(t){u(a,r,o,c,s,"next",t)}function s(t){u(a,r,o,c,s,"throw",t)}c(void 0)}))}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function f(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function l(t,e){return(l=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function p(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=h(t);if(e){var o=h(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return b(this,n)}}function b(t,e){return!e||"object"!==c(e)&&"function"!=typeof e?m(t):e}function m(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function h(t){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function y(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var d=new Headers({"content-type":"application/json","X-WP-Nonce":Globals.rest_nonce}),v={updateBasket:Globals.api_url+"pmachine/task-basket/update",updateForm:Globals.api_url+"pmachine/form/update-key-value"},k=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&l(t,e)}(b,t);var e,n,c,u=p(b);function b(){var t;i(this,b);for(var e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];return y(m(t=u.call.apply(u,[this].concat(n))),"state",{loading:!1,paymentActive:!1,view:!1}),y(m(t),"paymentComplete",s(regeneratorRuntime.mark((function e(){var n,r,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.props,r=n.close,o=n.tasks,e.next=3,o.forEach(function(){var t=s(regeneratorRuntime.mark((function t(e){var n,o,a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n="purchased",o={method:"post",mode:"cors",body:JSON.stringify({task:e.task,status:n}),headers:d},t.next=4,fetch(v.updateBasket,o);case 4:return a=t.sent,t.next=7,a.json();case 7:return t.sent,o={method:"post",mode:"cors",body:JSON.stringify([{id:e.task,status:n}]),headers:d},t.next=11,fetch(v.updateForm,o);case 11:return a=t.sent,t.next=14,a.json();case 14:t.sent,document.dispatchEvent(new CustomEvent("tasks-updated")),r();case 17:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}());case 3:case"end":return e.stop()}}),e)})))),y(m(t),"pay",(function(){t.setState({paymentActive:!0},s(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.paymentHtml();case 2:case"end":return e.stop()}}),e)}))))})),y(m(t),"paymentHtml",s(regeneratorRuntime.mark((function e(){var n,a,c,u,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.props,a=n.tasks,c=n.close,t.setState({loading:!0}),u=Object(r.h)("h3",null,"Payment for tasks"),i=Object(r.h)("p",{className:"alignright"},Object(r.h)("br",null),Object(r.h)("button",{onClick:function(){return c()},className:"dpl-button small"},"Close")),t.setState({view:Object(r.h)("div",null,u,Object(r.h)(o.default,{tasks:a}),i),loading:!1},s(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}}),t)}))));case 5:case"end":return e.stop()}}),e)})))),y(m(t),"tasksHtml",(function(){var e=t.props,n=e.tasks,o=e.close,a=m(t).pay,c=Object(r.h)("h3",null,"Tasks in basket"),u=Object(r.h)("div",{className:"task-basket__row"},Object(r.h)("div",{className:"task-basket__task"},"Task"),Object(r.h)("div",{className:"task-basket__amount"},"Amount"),Object(r.h)("div",{className:"task-basket__status"},"Status")),s=n.map((function(t,e){return Object(r.h)("div",{className:"task-basket__row"},Object(r.h)("div",{className:"task-basket__task"},t.task),Object(r.h)("div",{className:"task-basket__amount"},(t.price/100).toFixed(2)),Object(r.h)("div",{className:" task-basket__status"},Object(r.h)("span",{className:t.status},t.status)))})),i=Object(r.h)("p",{className:"alignright"},Object(r.h)("br",null),Object(r.h)("button",{onClick:function(){return a()},className:"dpl-button small"},"Pay"),"Â ",Object(r.h)("button",{onClick:function(){return o()},className:"dpl-button small"},"Close"));t.setState({view:Object(r.h)("div",null,c,u,s,i),loading:!1})})),t}return e=b,(n=[{key:"componentDidMount",value:function(){var t=this;this.tasksHtml(),document.addEventListener("payment-accepted",s(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.paymentComplete();case 1:case"end":return e.stop()}}),e)}))))}},{key:"render",value:function(){var t=this.state,e=t.loading,n=t.view;return e?Object(r.h)(a.default,null):n}}])&&f(e.prototype,n),c&&f(e,c),b}(r.Component)},384:function(t,e,n){"use strict";n.r(e),n.d(e,"default",(function(){return l}));var r=n(415);function o(t){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function c(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function u(t,e){return(u=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function s(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=f(t);if(e){var o=f(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return i(this,n)}}function i(t,e){return!e||"object"!==o(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function f(t){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var l=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&u(t,e)}(f,t);var e,n,o,i=s(f);function f(){return a(this,f),i.apply(this,arguments)}return e=f,(n=[{key:"render",value:function(){var t=this.props.count;return Object(r.h)("div",{className:"task-basket__badge"},Object(r.h)("span",{className:"task-basket__badge-wrap"},Object(r.h)("svg",{className:"icon icon-shopping-cart"},Object(r.h)("use",{"xlink:href":"#icon-shopping-cart"})),!!t&&Object(r.h)("span",{className:"task-basket__count"},t)))}}])&&c(e.prototype,n),o&&c(e,o),f}(r.Component)},392:function(t,e,n){"use strict";n.r(e),n.d(e,"default",(function(){return g}));var r=n(415),o=n(382),a=n(384),c=n(430),u=n.n(c);function s(t){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function i(t,e,n,r,o,a,c){try{var u=t[a](c),s=u.value}catch(t){return void n(t)}u.done?e(s):Promise.resolve(s).then(r,o)}function f(t){return function(){var e=this,n=arguments;return new Promise((function(r,o){var a=t.apply(e,n);function c(t){i(a,r,o,c,u,"next",t)}function u(t){i(a,r,o,c,u,"throw",t)}c(void 0)}))}}function l(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function p(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function b(t,e){return(b=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function m(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=d(t);if(e){var o=d(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return h(this,n)}}function h(t,e){return!e||"object"!==s(e)&&"function"!=typeof e?y(t):e}function y(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function d(t){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function v(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var k={content:{top:"50%",left:"50%",right:"auto",bottom:"auto",marginRight:"-50%",transform:"translate(-50%, -50%)",maxWidth:"500px",minWidth:"320px"}},w=Globals.api_url+"pmachine/task-basket/get/",O=(Globals.api_url,new Headers({"content-type":"application/json","X-WP-Nonce":Globals.rest_nonce})),g=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&b(t,e)}(i,t);var e,n,c,s=m(i);function i(){var t;l(this,i);for(var e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];return v(y(t=s.call.apply(s,[this].concat(n))),"state",{open:!1,content:Object(r.h)("div",{className:"spinner"}),count:0,paymentActive:!1}),v(y(t),"componentWillMount",f(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:document.addEventListener("tasks-updated",f(regeneratorRuntime.mark((function e(){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.fetch();case 2:r=e.sent,(n=r.length)>0&&t.setState({count:n});case 5:case"end":return e.stop()}}),e)})))),document.dispatchEvent(new CustomEvent("tasks-updated"));case 2:case"end":return e.stop()}}),e)})))),v(y(t),"fetch",f(regeneratorRuntime.mark((function t(){var e,n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e={method:"get",credentials:"include",mode:"cors",headers:O},t.next=3,fetch(w+"waiting",e);case 3:return n=t.sent,t.next=6,n.json();case 6:return t.abrupt("return",t.sent);case 7:case"end":return t.stop()}}),t)})))),v(y(t),"handleClick",function(){var e=f(regeneratorRuntime.mark((function e(n){var a,c,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.state.count,n.preventDefault(),0!==a){e.next=4;break}return e.abrupt("return",!1);case 4:return c=t.state.paymentActive,t.setState({open:!0}),e.next=8,t.fetch();case 8:u=e.sent,t.setState({content:Object(r.h)(o.default,{tasks:u,close:function(){return t.close()},paymentActive:c})});case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),t}return e=i,(n=[{key:"close",value:function(){this.setState({open:!1}),this.setState({paymentActive:!1})}},{key:"pay",value:function(){this.setState({paymentActive:!0})}},{key:"render",value:function(){var t=this,e=this.state,n=e.open,o=e.content,c=e.count;return Object(r.h)("div",null,Object(r.h)("a",{className:"menu-item",href:"",onClick:function(e){return t.handleClick(e)}},"Task Basket ",Object(r.h)(a.default,{count:c})),Object(r.h)(u.a,{isOpen:n,style:k,contentLabel:"Task Basket"},o))}}])&&p(e.prototype,n),c&&p(e,c),i}(r.Component)}}]);
//# sourceMappingURL=15.71b2921ddb6c7058efad.js.map